<template>
  <div class="knowledge-management">
    <el-container>
      <!-- È°∂ÈÉ®Êìç‰ΩúÊ†è -->
      <el-header class="header">
        <div class="header-left">
          <h2>üìö Áü•ËØÜÂ∫ìÁÆ°ÁêÜ</h2>
          <el-tag v-if="knowledgeStats.total_knowledge_points > 0" type="success">
            Â∑≤Êúâ {{ knowledgeStats.total_knowledge_points }} ‰∏™Áü•ËØÜÁÇπ
          </el-tag>
          <el-tag v-else type="warning">Áü•ËØÜÂ∫ì‰∏∫Á©∫</el-tag>
        </div>
        <div class="header-right">
          <el-button type="primary" @click="showImportDialog = true" :icon="Upload">
            ÂØºÂÖ•Áü•ËØÜÂ∫ì
          </el-button>
          <el-button @click="loadKnowledgeData" :icon="Refresh">Âà∑Êñ∞</el-button>
        </div>
      </el-header>

      <el-main>
        <el-tabs v-model="activeTab" type="border-card">
          <!-- Áü•ËØÜÂõæË∞± -->
          <el-tab-pane label="üìä Áü•ËØÜÂõæË∞±" name="graph">
            <div class="graph-container">
              <div v-if="knowledgeStats.total_knowledge_points === 0" class="empty-state">
                <el-empty description="ÊöÇÊó†Áü•ËØÜÁÇπÊï∞ÊçÆ">
                  <el-button type="primary" @click="showImportDialog = true">
                    ÂØºÂÖ•Áü•ËØÜÂ∫ì
                  </el-button>
                </el-empty>
              </div>
              <div v-else id="knowledge-graph" style="height: 600px;"></div>
            </div>
          </el-tab-pane>

          <!-- Áü•ËØÜÂüüÁÆ°ÁêÜ -->
          <el-tab-pane label="üèóÔ∏è Áü•ËØÜÂüü" name="domains">
            <div class="domains-grid">
              <el-card 
                v-for="domain in domains" 
                :key="domain.id"
                class="domain-card"
                shadow="hover"
              >
                <template #header>
                  <div class="card-header">
                    <span class="domain-name">{{ domain.name }}</span>
                    <el-tag type="info">{{ domain.knowledge_points_count }} ‰∏™Áü•ËØÜÁÇπ</el-tag>
                  </div>
                </template>
                <div class="domain-content">
                  <p class="domain-desc">{{ domain.description }}</p>
                  <div class="domain-stats">
                    <el-progress 
                      :percentage="Math.round(domain.exam_weight * 100)" 
                      :stroke-width="8"
                      :show-text="false"
                    />
                    <span class="weight-text">ËÄÉËØïÊùÉÈáç: {{ (domain.exam_weight * 100).toFixed(1) }}%</span>
                  </div>
                  <el-button 
                    type="text" 
                    @click="viewDomainDetails(domain)"
                    class="view-details-btn"
                  >
                    Êü•ÁúãËØ¶ÊÉÖ ‚Üí
                  </el-button>
                </div>
              </el-card>
            </div>
          </el-tab-pane>

          <!-- Áü•ËØÜÁÇπÂàóË°® -->
          <el-tab-pane label="üìù Áü•ËØÜÁÇπ" name="points">
            <div class="points-toolbar">
              <el-select v-model="selectedDomainId" placeholder="Á≠õÈÄâÁü•ËØÜÂüü" clearable style="width: 200px;">
                <el-option 
                  v-for="domain in domains" 
                  :key="domain.id"
                  :label="domain.name" 
                  :value="domain.id"
                />
              </el-select>
              <el-input 
                v-model="searchKeyword" 
                placeholder="ÊêúÁ¥¢Áü•ËØÜÁÇπ..."
                style="width: 300px;"
                :prefix-icon="Search"
                clearable
              />
            </div>
            
            <el-table :data="filteredKnowledgePoints" stripe>
              <el-table-column prop="name" label="Áü•ËØÜÁÇπÂêçÁß∞" min-width="200" />
              <el-table-column prop="domain_name" label="ÊâÄÂ±ûÂüü" width="150" />
              <el-table-column prop="difficulty_level" label="ÈöæÂ∫¶" width="80">
                <template #default="{ row }">
                  <el-rate 
                    v-model="row.difficulty_level" 
                    :max="5" 
                    disabled 
                    show-score
                    text-color="#ff9900"
                  />
                </template>
              </el-table-column>
              <el-table-column prop="exam_weight" label="ËÄÉËØïÊùÉÈáç" width="100">
                <template #default="{ row }">
                  {{ (row.exam_weight * 100).toFixed(1) }}%
                </template>
              </el-table-column>
              <el-table-column prop="estimated_study_hours" label="È¢Ñ‰º∞Â≠¶Êó∂" width="100">
                <template #default="{ row }">
                  {{ row.estimated_study_hours }}h
                </template>
              </el-table-column>
              <el-table-column prop="prerequisites_count" label="ÂâçÁΩÆÊù°‰ª∂" width="100" />
              <el-table-column label="Êìç‰Ωú" width="120">
                <template #default="{ row }">
                  <el-button type="text" size="small" @click="viewPointDetails(row)">
                    ËØ¶ÊÉÖ
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </el-tab-pane>

          <!-- ÁªüËÆ°ÂàÜÊûê -->
          <el-tab-pane label="üìà ÁªüËÆ°ÂàÜÊûê" name="statistics">
            <div class="stats-container">
              <el-row :gutter="20">
                <el-col :span="6">
                  <el-statistic title="Áü•ËØÜÂüüÊÄªÊï∞" :value="knowledgeStats.total_domains" />
                </el-col>
                <el-col :span="6">
                  <el-statistic title="Áü•ËØÜÁÇπÊÄªÊï∞" :value="knowledgeStats.total_knowledge_points" />
                </el-col>
                <el-col :span="6">
                  <el-statistic title="ÊäÄËÉΩÁÇπÊÄªÊï∞" :value="knowledgeStats.total_skill_points" />
                </el-col>
                <el-col :span="6">
                  <el-statistic title="È¢Ñ‰º∞ÊÄªÂ≠¶Êó∂" :value="knowledgeStats.total_study_hours" suffix="Â∞èÊó∂" />
                </el-col>
              </el-row>

              <el-row :gutter="20" style="margin-top: 30px;">
                <el-col :span="12">
                  <el-card title="ÈöæÂ∫¶ÂàÜÂ∏É">
                    <div id="difficulty-chart" style="height: 300px;"></div>
                  </el-card>
                </el-col>
                <el-col :span="12">
                  <el-card title="ÊùÉÈáçÂàÜÂ∏É">
                    <div id="weight-chart" style="height: 300px;"></div>
                  </el-card>
                </el-col>
              </el-row>

              <el-row style="margin-top: 20px;">
                <el-col :span="24">
                  <el-card title="Â≠¶‰π†Êó∂Èó¥È¢Ñ‰º∞">
                    <el-descriptions :column="4" border>
                      <el-descriptions-item label="ÊØèÂ§©2Â∞èÊó∂">
                        {{ knowledgeStats.days_2h_per_day }} Â§©
                      </el-descriptions-item>
                      <el-descriptions-item label="ÊØèÂ§©4Â∞èÊó∂">
                        {{ knowledgeStats.days_4h_per_day }} Â§©
                      </el-descriptions-item>
                      <el-descriptions-item label="ÊØèÂë®20Â∞èÊó∂">
                        {{ knowledgeStats.weeks_20h_per_week }} Âë®
                      </el-descriptions-item>
                      <el-descriptions-item label="ËÄÉÂâçÂÜ≤Âà∫">
                        2-3 Âë®
                      </el-descriptions-item>
                    </el-descriptions>
                  </el-card>
                </el-col>
              </el-row>
            </div>
          </el-tab-pane>
        </el-tabs>
      </el-main>
    </el-container>

    <!-- ÂØºÂÖ•ÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="showImportDialog"
      title="üìÅ ÂØºÂÖ•Áü•ËØÜÂ∫ì"
      width="600px"
      :close-on-click-modal="false"
    >
      <div class="import-methods">
        <el-tabs v-model="importMethod" type="card">
          <!-- Êñá‰ª∂‰∏ä‰º†ÊñπÂºè -->
          <el-tab-pane label="üì§ ‰∏ä‰º†Êñá‰ª∂" name="upload">
            <div class="upload-area">
              <el-upload
                ref="uploadRef"
                :action="uploadUrl"
                :headers="uploadHeaders"
                :data="uploadData"
                :on-success="handleUploadSuccess"
                :on-error="handleUploadError"
                :before-upload="beforeUpload"
                :file-list="fileList"
                drag
                multiple
                accept=".pdf,.doc,.docx,.md,.txt,.zip"
              >
                <el-icon class="el-icon--upload"><upload-filled /></el-icon>
                <div class="el-upload__text">
                  ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÔºåÊàñ<em>ÁÇπÂáª‰∏ä‰º†</em>
                </div>
                <div class="el-upload__tip">
                  ÊîØÊåÅ PDF„ÄÅWord„ÄÅMarkdown„ÄÅÊñáÊú¨Êñá‰ª∂ÂèäÂéãÁº©ÂåÖ
                </div>
              </el-upload>
            </div>
          </el-tab-pane>

          <!-- Ëá™Âä®Êâ´ÊèèÊñπÂºè -->
          <el-tab-pane label="üîç Ëá™Âä®Êâ´Êèè" name="scan">
            <div class="scan-area">
              <el-alert
                title="Ëá™Âä®Êâ´ÊèèËØ¥Êòé"
                type="info"
                description="Á≥ªÁªüÂ∞ÜÊâ´ÊèèDockerÂÆπÂô®‰∏≠ÁöÑÂ≠¶‰π†ËµÑÊñôÁõÆÂΩïÔºåËá™Âä®ËØÜÂà´Âπ∂ÂØºÂÖ•Áü•ËØÜ‰ΩìÁ≥ª"
                :closable="false"
                style="margin-bottom: 20px;"
              />
              
              <el-form :model="scanForm" label-width="120px">
                <el-form-item label="Êâ´ÊèèÁõÆÂΩï">
                  <el-input 
                    v-model="scanForm.directory" 
                    placeholder="/app/resources/System_Architect"
                    readonly
                  />
                </el-form-item>
                <el-form-item label="ÂØºÂÖ•ÈÄâÈ°π">
                  <el-checkbox v-model="scanForm.force_reimport">Âº∫Âà∂ÈáçÊñ∞ÂØºÂÖ•</el-checkbox>
                  <el-checkbox v-model="scanForm.include_case_studies">ÂåÖÂê´Ê°à‰æãÂàÜÊûê</el-checkbox>
                </el-form-item>
              </el-form>

              <el-button 
                type="primary" 
                @click="startAutoScan"
                :loading="importing"
                style="width: 100%;"
              >
                ÂºÄÂßãËá™Âä®Êâ´ÊèèÂØºÂÖ•
              </el-button>
            </div>
          </el-tab-pane>

          <!-- RAGÂêëÈáèÂåñÊñπÂºè -->
          <el-tab-pane label="ü§ñ Êô∫ËÉΩÂ§ÑÁêÜ" name="rag">
            <div class="rag-area">
              <el-alert
                title="Êô∫ËÉΩÊñáÊ°£Â§ÑÁêÜ"
                type="success"
                description="‰ΩøÁî®RAGÊäÄÊúØÂØπÊñáÊ°£ËøõË°åÂêëÈáèÂåñÂ§ÑÁêÜÔºåÊîØÊåÅÊô∫ËÉΩÈóÆÁ≠îÂíåÂÜÖÂÆπÊ£ÄÁ¥¢"
                :closable="false"
                style="margin-bottom: 20px;"
              />
              
              <el-form :model="ragForm" label-width="120px">
                <el-form-item label="Â§ÑÁêÜÊ®°Âºè">
                  <el-radio-group v-model="ragForm.mode">
                    <el-radio label="full">ÂÆåÊï¥Â§ÑÁêÜ</el-radio>
                    <el-radio label="incremental">Â¢ûÈáèÊõ¥Êñ∞</el-radio>
                  </el-radio-group>
                </el-form-item>
                <el-form-item label="ÂêëÈáèÊ®°Âûã">
                  <el-select v-model="ragForm.embedding_model">
                    <el-option label="text-embedding-ada-002" value="ada-002" />
                    <el-option label="BGE-M3 (Êú¨Âú∞)" value="bge-m3" />
                  </el-select>
                </el-form-item>
                <el-form-item label="ÂàÜÂùóÂ§ßÂ∞è">
                  <el-slider v-model="ragForm.chunk_size" :min="256" :max="2048" :step="256" />
                  <span style="margin-left: 10px;">{{ ragForm.chunk_size }} Â≠óÁ¨¶</span>
                </el-form-item>
              </el-form>

              <el-button 
                type="success" 
                @click="startRAGProcessing"
                :loading="ragProcessing"
                style="width: 100%;"
              >
                ÂºÄÂßãÊô∫ËÉΩÂ§ÑÁêÜ
              </el-button>
            </div>
          </el-tab-pane>
        </el-tabs>
      </div>

      <!-- ÂØºÂÖ•ËøõÂ∫¶ -->
      <div v-if="importing || ragProcessing" class="import-progress">
        <el-divider>ÂØºÂÖ•ËøõÂ∫¶</el-divider>
        <el-progress 
          :percentage="importProgress.progress * 100" 
          :status="importProgress.status === 'error' ? 'exception' : 'success'"
        />
        <p class="progress-message">{{ importProgress.message }}</p>
        
        <div v-if="importProgress.details" class="progress-details">
          <el-descriptions :column="2" size="small" border>
            <el-descriptions-item label="Áü•ËØÜÂüü">
              {{ importProgress.details.domains_created || 0 }}
            </el-descriptions-item>
            <el-descriptions-item label="Áü•ËØÜÁÇπ">
              {{ importProgress.details.knowledge_points_created || 0 }}
            </el-descriptions-item>
            <el-descriptions-item label="ÊäÄËÉΩÁÇπ">
              {{ importProgress.details.skill_points_created || 0 }}
            </el-descriptions-item>
            <el-descriptions-item label="‰æùËµñÂÖ≥Á≥ª">
              {{ importProgress.details.dependencies_created || 0 }}
            </el-descriptions-item>
          </el-descriptions>
        </div>
      </div>

      <template #footer>
        <span class="dialog-footer">
          <el-button @click="showImportDialog = false" :disabled="importing || ragProcessing">
            ÂèñÊ∂à
          </el-button>
          <el-button 
            v-if="importProgress.status === 'completed'" 
            type="primary" 
            @click="handleImportComplete"
          >
            ÂÆåÊàê
          </el-button>
        </span>
      </template>
    </el-dialog>

    <!-- Áü•ËØÜÁÇπËØ¶ÊÉÖÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="showPointDialog"
      :title="selectedPoint?.name"
      width="800px"
    >
      <div v-if="selectedPoint" class="point-details">
        <!-- Áü•ËØÜÁÇπËØ¶ÊÉÖÂÜÖÂÆπ -->
        <el-descriptions :column="2" border>
          <el-descriptions-item label="ÊâÄÂ±ûÂüü">
            {{ selectedPoint.domain?.name }}
          </el-descriptions-item>
          <el-descriptions-item label="ÈöæÂ∫¶Á∫ßÂà´">
            <el-rate v-model="selectedPoint.difficulty_level" :max="5" disabled />
          </el-descriptions-item>
          <el-descriptions-item label="ËÄÉËØïÊùÉÈáç">
            {{ (selectedPoint.exam_weight * 100).toFixed(1) }}%
          </el-descriptions-item>
          <el-descriptions-item label="È¢Ñ‰º∞Â≠¶Êó∂">
            {{ selectedPoint.estimated_study_hours }} Â∞èÊó∂
          </el-descriptions-item>
        </el-descriptions>

        <el-divider>Â≠¶‰π†ÁõÆÊ†á</el-divider>
        <ul v-if="selectedPoint.learning_objectives">
          <li v-for="objective in selectedPoint.learning_objectives" :key="objective">
            {{ objective }}
          </li>
        </ul>

        <el-divider>ÂâçÁΩÆÁü•ËØÜÁÇπ</el-divider>
        <div v-if="selectedPoint.prerequisites?.length > 0" class="prerequisites">
          <el-tag 
            v-for="prereq in selectedPoint.prerequisites" 
            :key="prereq.id"
            style="margin-right: 8px; margin-bottom: 8px;"
          >
            {{ prereq.name }}
          </el-tag>
        </div>
        <p v-else class="no-data">Êó†ÂâçÁΩÆË¶ÅÊ±Ç</p>

        <el-divider>ÊäÄËÉΩÁÇπ</el-divider>
        <div v-if="selectedPoint.skill_points?.length > 0" class="skill-points">
          <el-card 
            v-for="skill in selectedPoint.skill_points" 
            :key="skill.id"
            style="margin-bottom: 10px;"
            shadow="never"
          >
            <h4>{{ skill.name }}</h4>
            <p>{{ skill.description }}</p>
            <el-tag size="small" :type="getSkillTypeColor(skill.skill_type)">
              {{ getSkillTypeName(skill.skill_type) }}
            </el-tag>
          </el-card>
        </div>
        <p v-else class="no-data">ÊöÇÊó†ÊäÄËÉΩÁÇπ</p>
      </div>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted, nextTick } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Upload, Refresh, Search, UploadFilled } from '@element-plus/icons-vue'
import * as echarts from 'echarts'
import axios from 'axios'

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const activeTab = ref('graph')
const showImportDialog = ref(false)
const showPointDialog = ref(false)
const importMethod = ref('scan')
const importing = ref(false)
const ragProcessing = ref(false)
const selectedDomainId = ref('')
const searchKeyword = ref('')

// Êï∞ÊçÆ
const domains = ref([])
const knowledgePoints = ref([])
const knowledgeStats = ref({})
const selectedPoint = ref(null)
const fileList = ref([])

// Ë°®ÂçïÊï∞ÊçÆ
const scanForm = reactive({
  directory: '/app/resources/System_Architect',
  force_reimport: false,
  include_case_studies: true
})

const ragForm = reactive({
  mode: 'full',
  embedding_model: 'bge-m3',
  chunk_size: 1024
})

// ÂØºÂÖ•ËøõÂ∫¶
const importProgress = reactive({
  status: 'idle',
  message: '',
  progress: 0,
  details: null
})

// ËÆ°ÁÆóÂ±ûÊÄß
const filteredKnowledgePoints = computed(() => {
  let filtered = knowledgePoints.value
  
  if (selectedDomainId.value) {
    const domain = domains.value.find(d => d.id === selectedDomainId.value)
    if (domain) {
      filtered = filtered.filter(kp => kp.domain_name === domain.name)
    }
  }
  
  if (searchKeyword.value) {
    const keyword = searchKeyword.value.toLowerCase()
    filtered = filtered.filter(kp => 
      kp.name.toLowerCase().includes(keyword) ||
      kp.description?.toLowerCase().includes(keyword)
    )
  }
  
  return filtered
})

// ‰∏ä‰º†ÈÖçÁΩÆ
const uploadUrl = `${import.meta.env.VITE_API_BASE_URL}/api/knowledge/upload`
const uploadHeaders = {
  'Authorization': `Bearer ${localStorage.getItem('token')}`
}
const uploadData = {
  type: 'knowledge_materials'
}

// ÊñπÊ≥ï
const loadKnowledgeData = async () => {
  try {
    // Âä†ËΩΩÁü•ËØÜÂüü
    const domainsRes = await axios.get('/api/knowledge/domains')
    domains.value = domainsRes.data

    // Âä†ËΩΩÁü•ËØÜÁÇπ
    const pointsRes = await axios.get('/api/knowledge/points')
    knowledgePoints.value = pointsRes.data

    // Âä†ËΩΩÁªüËÆ°‰ø°ÊÅØ
    const statsRes = await axios.get('/api/knowledge/statistics')
    knowledgeStats.value = statsRes.data.basic_statistics
    
    // Êõ¥Êñ∞ÂõæË°®
    if (activeTab.value === 'statistics') {
      nextTick(() => {
        renderCharts(statsRes.data)
      })
    }
  } catch (error) {
    ElMessage.error('Âä†ËΩΩÁü•ËØÜÂ∫ìÊï∞ÊçÆÂ§±Ë¥•')
    console.error(error)
  }
}

const startAutoScan = async () => {
  try {
    importing.value = true
    importProgress.status = 'running'
    importProgress.message = 'Ê≠£Âú®ÂêØÂä®Ëá™Âä®Êâ´Êèè...'
    importProgress.progress = 0

    // ÂêØÂä®ÂØºÂÖ•‰ªªÂä°
    await axios.post('/api/knowledge/import/start', scanForm)
    
    // ËΩÆËØ¢ËøõÂ∫¶
    pollImportProgress()
  } catch (error) {
    importing.value = false
    ElMessage.error(error.response?.data?.detail || 'ÂêØÂä®ÂØºÂÖ•Â§±Ë¥•')
  }
}

const pollImportProgress = async () => {
  try {
    const res = await axios.get('/api/knowledge/import/status')
    const progress = res.data
    
    Object.assign(importProgress, progress)
    
    if (progress.status === 'completed') {
      importing.value = false
      ElMessage.success('Áü•ËØÜÂ∫ìÂØºÂÖ•ÂÆåÊàêÔºÅ')
      await loadKnowledgeData()
    } else if (progress.status === 'error') {
      importing.value = false
      ElMessage.error(`ÂØºÂÖ•Â§±Ë¥•: ${progress.message}`)
    } else if (progress.status === 'running') {
      // ÁªßÁª≠ËΩÆËØ¢
      setTimeout(pollImportProgress, 2000)
    }
  } catch (error) {
    importing.value = false
    ElMessage.error('Ëé∑ÂèñÂØºÂÖ•ËøõÂ∫¶Â§±Ë¥•')
  }
}

const startRAGProcessing = async () => {
  try {
    ragProcessing.value = true
    ElMessage.info('RAGÂ§ÑÁêÜÂäüËÉΩÂºÄÂèë‰∏≠...')
    
    // TODO: ÂÆûÁé∞RAGÂ§ÑÁêÜÈÄªËæë
    setTimeout(() => {
      ragProcessing.value = false
      ElMessage.success('RAGÂ§ÑÁêÜÂÆåÊàê')
    }, 3000)
  } catch (error) {
    ragProcessing.value = false
    ElMessage.error('RAGÂ§ÑÁêÜÂ§±Ë¥•')
  }
}

const viewPointDetails = async (point) => {
  try {
    const res = await axios.get(`/api/knowledge/points/${point.id}/details`)
    selectedPoint.value = res.data
    showPointDialog.value = true
  } catch (error) {
    ElMessage.error('Ëé∑ÂèñÁü•ËØÜÁÇπËØ¶ÊÉÖÂ§±Ë¥•')
  }
}

const viewDomainDetails = (domain) => {
  selectedDomainId.value = domain.id
  activeTab.value = 'points'
}

const handleImportComplete = () => {
  showImportDialog.value = false
  importProgress.status = 'idle'
  importProgress.message = ''
  importProgress.progress = 0
  importProgress.details = null
}

// ‰∏ä‰º†Áõ∏ÂÖ≥ÊñπÊ≥ï
const beforeUpload = (file) => {
  const isValidType = [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'text/markdown',
    'text/plain',
    'application/zip'
  ].includes(file.type)
  
  if (!isValidType) {
    ElMessage.error('Âè™ÊîØÊåÅ PDF„ÄÅWord„ÄÅMarkdown„ÄÅÊñáÊú¨Êñá‰ª∂ÂèäÂéãÁº©ÂåÖ')
    return false
  }
  
  const isLt100M = file.size / 1024 / 1024 < 100
  if (!isLt100M) {
    ElMessage.error('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá 100MB')
    return false
  }
  
  return true
}

const handleUploadSuccess = (response, file) => {
  ElMessage.success(`${file.name} ‰∏ä‰º†ÊàêÂäü`)
  // TODO: Â§ÑÁêÜ‰∏ä‰º†ÊàêÂäüÂêéÁöÑÈÄªËæë
}

const handleUploadError = (error, file) => {
  ElMessage.error(`${file.name} ‰∏ä‰º†Â§±Ë¥•`)
}

// Â∑•ÂÖ∑ÊñπÊ≥ï
const getSkillTypeName = (type) => {
  const typeMap = {
    'concept': 'Ê¶ÇÂøµ',
    'technique': 'ÊäÄÂ∑ß', 
    'application': 'Â∫îÁî®'
  }
  return typeMap[type] || type
}

const getSkillTypeColor = (type) => {
  const colorMap = {
    'concept': '',
    'technique': 'warning',
    'application': 'success'
  }
  return colorMap[type] || ''
}

const renderCharts = (statsData) => {
  // ÈöæÂ∫¶ÂàÜÂ∏ÉÂõæ
  const difficultyChart = echarts.init(document.getElementById('difficulty-chart'))
  const difficultyOption = {
    title: { text: 'Áü•ËØÜÁÇπÈöæÂ∫¶ÂàÜÂ∏É' },
    tooltip: {},
    xAxis: { data: Object.keys(statsData.difficulty_distribution) },
    yAxis: {},
    series: [{
      type: 'bar',
      data: Object.values(statsData.difficulty_distribution),
      itemStyle: { color: '#409EFF' }
    }]
  }
  difficultyChart.setOption(difficultyOption)

  // ÊùÉÈáçÂàÜÂ∏ÉÂõæ
  const weightChart = echarts.init(document.getElementById('weight-chart'))
  const weightOption = {
    title: { text: 'ËÄÉËØïÊùÉÈáçÂàÜÂ∏É' },
    tooltip: {},
    series: [{
      type: 'pie',
      data: Object.entries(statsData.weight_distribution).map(([name, value]) => ({
        name, value
      })),
      radius: '70%'
    }]
  }
  weightChart.setOption(weightOption)
}

// ÁîüÂëΩÂë®Êúü
onMounted(() => {
  loadKnowledgeData()
})
</script>

<style scoped>
.knowledge-management {
  padding: 20px;
  height: calc(100vh - 40px);
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  background: #f5f5f5;
  border-bottom: 1px solid #ddd;
}

.header-left h2 {
  margin: 0 20px 0 0;
}

.domains-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  padding: 20px;
}

.domain-card {
  transition: transform 0.2s;
}

.domain-card:hover {
  transform: translateY(-5px);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.domain-content {
  padding: 10px 0;
}

.domain-desc {
  color: #666;
  margin-bottom: 15px;
}

.domain-stats {
  margin-bottom: 15px;
}

.weight-text {
  font-size: 12px;
  color: #999;
  margin-top: 5px;
  display: block;
}

.view-details-btn {
  width: 100%;
}

.points-toolbar {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  align-items: center;
}

.stats-container {
  padding: 20px;
}

.graph-container {
  padding: 20px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.import-methods {
  margin-bottom: 20px;
}

.upload-area, .scan-area, .rag-area {
  padding: 20px;
  min-height: 200px;
}

.import-progress {
  margin-top: 20px;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 6px;
}

.progress-message {
  text-align: center;
  margin: 10px 0;
  color: #666;
}

.progress-details {
  margin-top: 15px;
}

.point-details {
  max-height: 500px;
  overflow-y: auto;
}

.no-data {
  color: #999;
  font-style: italic;
}

.prerequisites {
  margin-bottom: 15px;
}

.skill-points .el-card {
  border: 1px solid #e4e7ed;
}

.skill-points h4 {
  margin: 0 0 8px 0;
  color: #303133;
}

.skill-points p {
  margin: 0 0 8px 0;
  color: #606266;
  font-size: 14px;
}
</style> 